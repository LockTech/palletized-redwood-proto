//
// Versioning for schema migrations:
// MAJOR versions include a significant change to one or more models; backwards compatability is not possible.
//    Ex: Removal of @relations or dependant-fields.
// MINOR versions include a small change to one or more models; backwards compatability may or may not be possible.
//    Ex: Renaming fields, adding an additional Model.
// PATCH versions include minute changes that affect or more models; backwards compatability is possible.
//    Ex: Adding a field to an existing Model.
//

// ID's SHOULD generated using some @unique field on a model.
// ID's SHOULD be completely unique-with no respect for case sensetivity.
// ID's SHOULD NOT contain any URL-reserved character. (RFC3986 | https://pretty-rfc.herokuapp.com/RFC3986#reserved)

datasource DS {
  provider            = "postgresql"
  url                 = "postgresql://palletized:secret@localhost:5432/palletized?schema=palletized"
}

generator client {
  provider            = "prisma-client-js"
  binaryTargets       = "native"
  previewFeatures     = ["groupBy"]
}

// `yarn redwood prisma migrate dev`
// create migrations and apply them to `DS`.

//
model Warehouse {
  @@map(name: "warehouses")

  id                  String              @id
  name                String              @unique
  updatedAt           DateTime            @updatedAt @default(now())
  createdAt           DateTime            @default(now())
  locations           Location[]
  defaultUsers        UserProfile[]
}

//
model Location {
  @@map(name: "locations")

  id                  String              @id
  name                String
  updatedAt           DateTime?           @updatedAt @default(now())
  createdAt           DateTime            @default(now())
  warehouse           Warehouse           @relation(fields: [warehouseId], references: [id])
  warehouseId         String
  pallets             Pallet[]

  @@unique([name, warehouseId])
}

//
model Product {
  @@map(name: "products")

  id                  String              @id
  partNumber          String              @unique
  description         String?
  updatedAt           DateTime?           @updatedAt @default(now())
  createdAt           DateTime            @default(now())
  palletProducts      PalletProduct[]
}

//
model Order {
  @@map(name: "orders")

  id                  String              @id
  orderNumber         String              @unique
  jobName             String?
  updatedAt           DateTime            @updatedAt @default(now())
  createdAt           DateTime            @default(now())
  pallets             Pallet[]
}

//
model Pallet {
  @@map(name: "pallets")

  id                  String              @id
  name                String              @unique
  updatedAt           DateTime            @updatedAt @default(now())
  createdAt           DateTime            @default(now())
  location            Location?           @relation(fields: [locationId], references: [id])
  locationId          String?
  order               Order?              @relation(fields: [orderId], references: [id])
  orderId             String?
  palletProducts      PalletProduct[]
  status              PalletStatus        @default(ACTIVE)
}

enum PalletStatus {
  ACTIVE
  SHIPPED
}

//
model PalletProduct {
  @@map(name: "pallet_products")

  id                  String              @id
  pallet              Pallet              @relation(fields: [palletId], references: [id])
  palletId            String
  product             Product             @relation(fields: [productId], references: [id])
  productId           String
  updatedAt           DateTime            @updatedAt @default(now())
  createdAt           DateTime            @default(now())

  @@unique([palletId, productId])
}

//
model UserProfile {
  @@map(name: "user_profile")

  id                  String              @id
  warehouse           Warehouse           @relation(fields: [warehouseId], references: [id])
  warehouseId         String
  updatedAt           DateTime            @updatedAt @default(now())
  createdAt           DateTime            @default(now())
}
