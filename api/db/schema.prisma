datasource DS {
  provider = "postgresql"
  url      = "postgresql://palletized:secret@localhost:5432/palletized?schema=palletized"
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = "native"
}

// `yarn redwood prisma migrate dev`
// create migrations and apply them to `DS`.

//
model Warehouse {
  @@map(name: "warehouses")

  id              String      @id @default(uuid())
  name            String      @unique
  updatedAt       DateTime    @updatedAt
  createdAt       DateTime    @default(now())
  locations       Location[]
}

//
model Location {
  @@map(name: "locations")

  id              String      @id @default(uuid())
  name            String
  updatedAt       DateTime?   @updatedAt
  createdAt       DateTime    @default(now())
  warehouse       Warehouse   @relation(fields: [warehouseId], references: [id])
  warehouseId     String
  pallets         Pallet[]
}

//
model Product {
  @@map(name: "products")

  id              String      @id @default(uuid())
  name            String      @unique
  updatedAt       DateTime?   @updatedAt
  createdAt       DateTime    @default(now())
}

//
model Order {
  @@map(name: "orders")

  id              String      @id @default(uuid())
  name            String
  updatedAt       DateTime    @updatedAt
  createdAt       DateTime    @default(now())
  pallets         Pallet[]
}

//
model Pallet {
  @@map(name: "pallets")

  id              String      @id @default(uuid())
  name            String
  updatedAt       DateTime    @updatedAt
  createdAt       DateTime    @default(now())
  location        Location?   @relation(fields: [locationId], references: [id])
  locationId      String?
  order           Order?      @relation(fields: [orderId], references: [id])
  orderId         String?
}

//
// Explicit m-n-relationship to allow for extra fields.
model PalletProduct {
  @@map(name: "pallet_products")

  id              String      @id @default(uuid())
  pallet          Pallet      @relation(fields: [palletId], references: [id])
  palletId        String
  product         Product     @relation(fields: [productId], references: [id])
  productId       String
  updatedAt       DateTime    @updatedAt
  createdAt       DateTime    @default(now())

  @@unique([palletId, productId])
}
